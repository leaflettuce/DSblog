<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Model Selection of Tree Classifiers in R - Andrew Trick</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="/img/favicon.ico" rel="icon">

<link rel="canonical" href="/tree_selection.html">

        <meta name="author" content="Andrew Trick" />
        <meta name="keywords" content="modeling,classification,r,caret,trees" />
        <meta name="description" content="A recent lab for my machine learning class involved fitting and tuning decision tree models in R to find the &#39;best&#39; option for predicting if a person will default given historic loan data. I work through the process of: processing the data for modeling, fitting it to a C5.0 decision tree model, comparing it to an 10-trial adaptive boosted version, and finally tuning the ensemble model to find the parameters which result in the highest accuracy." />

        <meta property="og:site_name" content="Andrew Trick" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Model Selection of Tree Classifiers in R"/>
        <meta property="og:url" content="/tree_selection.html"/>
        <meta property="og:description" content="A recent lab for my machine learning class involved fitting and tuning decision tree models in R to find the &#39;best&#39; option for predicting if a person will default given historic loan data. I work through the process of: processing the data for modeling, fitting it to a C5.0 decision tree model, comparing it to an 10-trial adaptive boosted version, and finally tuning the ensemble model to find the parameters which result in the highest accuracy."/>
        <meta property="article:published_time" content="2019-01-28" />
            <meta property="article:section" content="Machine Learning" />
            <meta property="article:tag" content="modeling" />
            <meta property="article:tag" content="classification" />
            <meta property="article:tag" content="r" />
            <meta property="article:tag" content="caret" />
            <meta property="article:tag" content="trees" />
            <meta property="article:author" content="Andrew Trick" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.simplex.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/friendly.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>
        <link href="/static/custom.css" rel="stylesheet">

        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Andrew Trick ATOM Feed"/>



        <link href="/feeds/machine-learning.atom.xml" type="application/atom+xml" rel="alternate"
              title="Andrew Trick Machine Learning ATOM Feed"/>
<script src="../js/d3.v3.min.js"></script>
<script src="../js/jquery-3.2.1.min.js"></script>
<script src="../js/respond.min.js"></script>
</head>
<body>
  
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
Andrew Trick            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="/pages/about.html">
                             About
                          </a></li>
                         <li><a href="/pages/datasets.html">
                             Datasets
                          </a></li>
                         <li><a href="/pages/resume.html">
                             Resume
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/tree_selection.html"
                       rel="bookmark"
                       title="Permalink to Model Selection of Tree Classifiers in R">
                        Model Selection of Tree Classifiers in R
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2019-01-28T15:30:00-06:00"> Mon 28 January 2019</time>
    </span>



        <span class="label label-default">Category</span>
        <a href="/category/machine-learning.html">Machine Learning</a>


<span class="label label-default">Tags</span>
	<a href="/tag/modeling.html">modeling</a>
        /
	<a href="/tag/classification.html">classification</a>
        /
	<a href="/tag/r.html">r</a>
        /
	<a href="/tag/caret.html">caret</a>
        /
	<a href="/tag/trees.html">trees</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h1>Model Selection of Tree Classifiers in R</h1>
<p><br>
A recent lab for my machine learning class involved fitting and tuning decision tree models in R to find the 'best' option for predicting if a loan will default given fictional historic loan data. I work through the process of: processing the data for modeling, fitting it to a C5.0 decision tree model, comparing it to an 10-trial adaptive boosted version, and finally tuning the ensemble model to find the parameters which result in the highest accuracy.<br><br></p>
<p>As most of my past work with machine learning has been done with scikit-learn in Python, I am finding this course to be extremely useful. Not only has it given me a deeper understanding of the strengths and weaknesses inherent in each type of algorithm, but it also included plenty of practice working in R. The textbook for this course is <em>"Machine Learning with R"</em> by Brett Lantz, and much of this process is taken from the book.
Data for this project is located at the <a href="https://archive.ics.uci.edu/ml/index.php">UCI Machine Learning Repository</a>.
<br></p>
<h2>Data Preprocessing</h2>
<p>As this post is focused on model creation and results analysis, I've elected to not report the importing, exploring, and processing steps for this project. Complete code for this project can be found at my <a href="https://github.com/leaflettuce/IT460-Coursework/blob/master/week_four/lab_4-2.R">GitHub</a>.
<br>
<br></p>
<h2>Data Modeling</h2>
<h4>C5.0 Decision Tree</h4>
<p>I first attempted to fit a standard C5.0 tree through the C50 library. This involves no parameter tuning to provide a base line of how accurate a tree is predicting given the inputs.
All models will be evaluated by their overall accuracy, kappa score, and ROC/AUC. The gmodels library gives an ease way to report all of these with the confusion matrix.</p>
<div class="highlight"><pre><span></span><span class="c1">######</span>
<span class="c1"># C5 #   </span>
<span class="c1">######</span>

<span class="c1">#train</span>
c5_model <span class="o">&lt;-</span> C5.0<span class="p">(</span>X_train<span class="p">,</span> y_train<span class="o">$</span>default<span class="p">)</span>
c5_model
<span class="c1"># Model Results</span>
<span class="kp">summary</span><span class="p">(</span>c5_model<span class="p">)</span>

<span class="c1"># Predict</span>
c5_pred <span class="o">&lt;-</span> predict<span class="p">(</span>c5_model<span class="p">,</span> X_test<span class="p">)</span>

<span class="c1"># probability</span>
c5_prob <span class="o">&lt;-</span><span class="kt">data.frame</span><span class="p">(</span>predict<span class="p">(</span>c5_model<span class="p">,</span> X_test<span class="p">,</span> type <span class="o">=</span> <span class="s">&#39;prob&#39;</span><span class="p">))</span>


<span class="c1"># matrix</span>
confusionMatrix<span class="p">(</span>c5_pred<span class="p">,</span> y_test<span class="o">$</span>default<span class="p">,</span> positive <span class="o">=</span> <span class="s">&quot;no&quot;</span><span class="p">)</span>
</pre></div>


<p>The following results in around 74% overall accuracy, 35% kappa and around 67% AUC. Not great but not terrible either. 
<br><br></p>
<h4>10-Trial Adaptive Boosting</h4>
<p>With these results, the next reasonable step is to attempt a boosted version of the C5.0 algorithm. The C5.0 library has this option built in and the number of trials can be specified. This is an ensemble method which trains on subsets of the data and iteratively trains the model based on results of previous fits, weighting error prone observations higher. Once a set number of trials are complete all of the 'weak' trees vote on the outcome of each test observation.</p>
<div class="highlight"><pre><span></span><span class="c1">###############</span>
<span class="c1"># AdaBoost 10 #   </span>
<span class="c1">###############</span>

<span class="c1"># Train</span>
ada10_model <span class="o">&lt;-</span> C5.0<span class="p">(</span>X_train<span class="p">,</span> y_train<span class="o">$</span>default<span class="p">,</span> trials <span class="o">=</span> <span class="m">10</span><span class="p">)</span>
ada10_model
<span class="c1"># Summary</span>
<span class="kp">summary</span><span class="p">(</span>ada10_model<span class="p">)</span>

<span class="c1"># Predict</span>
ada10_pred <span class="o">&lt;-</span> predict<span class="p">(</span>ada10_model<span class="p">,</span> X_test<span class="p">)</span>

<span class="c1"># probability</span>
ada10_prob <span class="o">&lt;-</span><span class="kt">data.frame</span><span class="p">(</span>predict<span class="p">(</span>ada10_model<span class="p">,</span> X_test<span class="p">,</span> type <span class="o">=</span> <span class="s">&#39;prob&#39;</span><span class="p">))</span>

<span class="c1"># matrix</span>
confusionMatrix<span class="p">(</span>ada10_pred<span class="p">,</span> y_test<span class="o">$</span>default<span class="p">,</span> positive <span class="o">=</span> <span class="s">&quot;no&quot;</span><span class="p">)</span>
</pre></div>


<p>The results are looking a little better from the original single tree:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../img/dt_selection/ada_results.png" style="width: 500px;"/>
<br><br></p>
<h4>Parameter Tuning with Caret</h4>
<p>Finally, one last method will be explored to see if we can boost the accuracy any higher by tweaking the parameters. The caret library provides ways to attempt this in R. 
I opted to use Cross Validation to evaluate the model in the parameter gird search:</p>
<div class="highlight"><pre><span></span><span class="c1"># Custom                   </span>
ctrl <span class="o">&lt;-</span> trainControl<span class="p">(</span>method <span class="o">=</span> <span class="s">&quot;cv&quot;</span><span class="p">,</span> number <span class="o">=</span> <span class="m">10</span><span class="p">,</span> selectionFunction <span class="o">=</span> <span class="s">&quot;best&quot;</span><span class="p">)</span>
grid <span class="o">&lt;-</span> <span class="kp">expand.grid</span><span class="p">(</span><span class="m">.</span>model <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;tree&quot;</span><span class="p">,</span> <span class="s">&quot;rules&quot;</span><span class="p">),</span>
                    <span class="m">.</span>trials <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> <span class="m">25</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="m">35</span><span class="p">),</span>
                    <span class="m">.</span>winnow <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">))</span>
m_cust <span class="o">&lt;-</span> train<span class="p">(</span>default <span class="o">~</span> <span class="m">.</span><span class="p">,</span> data <span class="o">=</span> df<span class="p">,</span> method <span class="o">=</span> <span class="s">&quot;C5.0&quot;</span><span class="p">,</span> 
                metric <span class="o">=</span> <span class="s">&#39;Kappa&#39;</span><span class="p">,</span>
                trControl <span class="o">=</span> ctrl<span class="p">,</span>
                tuneGrid <span class="o">=</span> grid<span class="p">)</span>
<span class="c1"># results</span>
m_cust
</pre></div>


<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../img/dt_selection/caret_results_2.png" style="width: 650px;"/>
<br>
Interestingly, grid search with cross validation returns a similar accuracy yet slightly lower kappa score than the original 10-trial adaboost.
It seems like we're hitting the upper bound of accuracy given this input data and a tree model.. An ROC visual can show us how this model trades off True positives with False positives:</p>
<div class="highlight"><pre><span></span><span class="c1">#ROC</span>
ada10_roc_pred <span class="o">&lt;-</span> prediction<span class="p">(</span>predictions <span class="o">=</span> ada10_prob<span class="o">$</span>yes<span class="p">,</span> labels <span class="o">=</span> y_test<span class="p">)</span>
ada10_perf <span class="o">&lt;-</span> performance<span class="p">(</span>ada10_roc_pred<span class="p">,</span> measure <span class="o">=</span> <span class="s">&#39;tpr&#39;</span><span class="p">,</span> x.measure <span class="o">=</span> <span class="s">&#39;fpr&#39;</span><span class="p">)</span>

<span class="c1"># plot</span>
plot<span class="p">(</span>ada10_perf<span class="p">,</span> main <span class="o">=</span> <span class="s">&quot;ROC surve for ada10 model of defaults&quot;</span><span class="p">,</span>
     col <span class="o">=</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> lwd <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
abline<span class="p">(</span>a <span class="o">=</span> <span class="m">0</span><span class="p">,</span> b <span class="o">=</span> <span class="m">1</span><span class="p">,</span> lwd <span class="o">=</span> <span class="m">2</span><span class="p">,</span> lty <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
</pre></div>


<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../img/dt_selection/ROC.png" style="width: 500px;"/>
<br>
Given the data and the difficulty involved in predicting loan default likelihood, I think this is a pretty solid model. Other tree or ensemble methods (such as bagging methods or JRip) may be able to squeeze out a slightly higher accuracy, but I expect not by a very significant amount.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="mailto:andyjtrick@gmail.com"><i class="fa fa-envelope-o fa-lg"></i> email</a></li>
                <li class="list-group-item"><a href="https://www.linkedin.com/in/andrew-trick-916011134"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                <li class="list-group-item"><a href="https://github.com/leaflettuce"><i class="fa fa-github-square fa-lg"></i> github</a></li>
                <li class="list-group-item"><a href="https://www.kaggle.com/leaflettuce"><i class="fa fa-database fa-lg"></i> kaggle</a></li>
                <li class="list-group-item"><a href="https://www.instagram.com/andyjtrick/"><i class="fa fa-instagram fa-lg"></i> instagram</a></li>
                <li class="list-group-item"><a href="https://www.meetup.com/members/13019733/"><i class="fa fa-meetup fa-lg"></i> meetup</a></li>
              </ul>
            </li>


            <li class="list-group-item"><a href="/"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="/category/data-visualization.html">
                            <i class="fa fa-folder-open fa-lg"></i> Data Visualization
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/exploratory-data-analysis.html">
                            <i class="fa fa-folder-open fa-lg"></i> Exploratory Data Analysis
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="/category/machine-learning.html">
                            <i class="fa fa-folder-open fa-lg"></i> Machine Learning
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                    <li class="list-group-item tag-1">
                        <a href="/tag/classification.html">
                            classification
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/reporting.html">
                            reporting
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/tableau.html">
                            Tableau
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/modeling.html">
                            modeling
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/visualizing.html">
                            visualizing
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/python.html">
                            python
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/eda.html">
                            EDA
                        </a>
                    </li>
                    <li class="list-group-item tag-1">
                        <a href="/tag/r.html">
                            r
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="/tag/manipulation.html">
                            manipulation
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="/tag/cleaning.html">
                            Cleaning
                        </a>
                    </li>
                </ul>
            </li>


    </ul>
</section>            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2019 Andrew Trick
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>

    <script src="/theme/js/bodypadding.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-106731472-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>